<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OpenVoiceBridge · 离线同声字幕 & SRT 生成器</title>
  <meta name="description" content="OpenVoiceBridge：隐私优先、离线可用、多语言的同声字幕与字幕文件生成器（基于 transformers.js Whisper）。">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./assets/icon-192.png">
  <link rel="apple-touch-icon" href="./assets/icon-192.png">
  <meta name="theme-color" content="#2f87ff">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="./assets/logo.svg" alt="OpenVoiceBridge logo" width="160" height="40">
      <div>
        <h1>OpenVoiceBridge</h1>
        <p class="tagline">离线 · 隐私 · 多语言｜实时字幕、文件转写与 SRT 导出。<span class="badge">PWA 可安装</span></p>
      </div>
    </div>

    <div class="card">
      <div class="controls">
        <select id="model" aria-label="选择模型">
          <option value="Xenova/whisper-tiny" selected>Whisper Tiny（默认，体积小，多语言）</option>
          <option value="Xenova/whisper-base">Whisper Base（较准，较大）</option>
          <option value="Xenova/whisper-small">Whisper Small（更准，更大）</option>
          <option value="Xenova/whisper-tiny.en">Whisper Tiny.en（仅英语，更快）</option>
        </select>
        <select id="language" aria-label="识别语言">
          <option value="auto" selected>自动检测语言</option>
          <option value="zh">中文</option>
          <option value="en">English</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
          <option value="de">Deutsch</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
        </select>
        <button id="startMic" class="primary">🎙️ 开始麦克风（快捷键 <span class="kbd">K</span>）</button>
        <button id="stopMic">■ 停止</button>
        <input id="file" type="file" accept="audio/*,video/*">
        <button id="exportSRT">⤓ 导出 SRT</button>
      </div>

      <div class="tabs">
        <div class="tab active">实时字幕</div>
        <div class="tab">文件转写</div>
      </div>

      <div class="grid">
        <div>
          <div id="caption" class="caption">…</div>
          <div class="small" style="margin-top:10px;">
            <span id="status" class="badge">准备就绪</span>
            <span id="stats" style="margin-left:10px;"></span>
          </div>
          <hr class="sep">
          <div id="segmentsList" class="small"></div>
        </div>
        <div>
          <div class="small">
            <p><strong>使用说明</strong></p>
            <ol>
              <li>选择模型与语言（默认自动检测）。首次加载模型需要联网，之后可离线使用。</li>
              <li>点击“开始麦克风”或直接选择音/视频文件进行转写。</li>
              <li>完成后可导出 <code>.srt</code> 字幕文件用于剪辑/播放。</li>
            </ol>
            <p>所有处理在本地浏览器执行，音频不会上传。若要长期离线使用，可在安装为 PWA 后首次加载完模型，之后断网也可继续使用。</p>
            <p class="small">提示：较大的模型更准确但更占内存；GitHub Pages 不支持跨源隔离，多线程 WASM 会被禁用，因此首次识别可能较慢，请耐心等待。</p>
          </div>
        </div>
      </div>
      <pre id="log" class="small" style="white-space:pre-wrap;margin-top:12px;"></pre>
    </div>

    <footer>
      <p>MIT © <span id="about-year"></span> OpenVoiceBridge • 让每一场对话都被看见 | <a href="https://github.com" target="_blank" rel="noopener">GitHub</a></p>
    </footer>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
